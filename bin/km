#!/usr/bin/env python3

import logging
import os.path

from kmux.cli import config, args
from kmux.gke import GKEUserKubeConfig
from kmux.kubeconfig import save_kube_config
from kmux.tmux import ensure_server, spawn_session

log = logging.getLogger()
log.setLevel(logging.INFO)


if args.gke:
    name = args.name
    location = args.location
    kubeconfig_location = os.path.expanduser("{}/{}".format(config['kubeconfig_dir'], name))
    kube_config = GKEUserKubeConfig()
    kube_config.set_cluster(name, location)
    kube_config.set_contexts([(name, "default")])
    save_kube_config(kubeconfig_location, kube_config)
    server = ensure_server()
    spawn_session(name, kubeconfig_location, server)
elif args.eks:
    raise NotImplementedError
else:
    raise NotImplementedError
